# 不动产登记收件统计系统需求文档

## 1. 系统概述

### 1.1 系统简介
不动产登记收件统计系统是一款专为不动产登记机构设计的业务管理系统，用于记录、管理和统计不动产登记收件数据，实现案件的公平分配、实时统计和可视化展示。

### 1.2 核心功能
- 不动产登记案件收件管理
- 案件分配与处理状态跟踪
- 多维度统计分析与图表展示
- 用户角色权限管理
- 实时数据更新与推送

### 1.3 技术架构
- **前端**：Vue 3 + Element Plus + ECharts
- **后端**：Node.js + Express
- **数据库**：MySQL
- **通信**：RESTful API + WebSocket

## 2. 功能需求

### 2.1 用户认证与授权

#### 2.1.1 登录功能
- **功能描述**：用户通过用户名和密码登录系统
- **界面元素**：
  - 用户名输入框：支持文本输入，必填
  - 密码输入框：支持密码输入，必填，显示/隐藏切换
  - 登录按钮：点击触发登录验证
  - 演示账户信息：显示默认用户名密码
- **业务规则**：
  - 用户名和密码不能为空
  - 支持回车键触发登录
  - 登录成功后根据角色自动跳转到对应工作台
  - 登录失败显示错误提示信息

#### 2.1.2 权限控制
- **功能描述**：根据用户角色控制系统功能访问权限
- **角色定义**：
  - **管理员**：系统管理权限，可访问所有功能
  - **开发商**：开发商业务权限，仅可访问开发商相关功能
  - **收件人**：普通用户权限，仅可访问个人收件和统计功能
  - **国资企业专窗**：国资企业业务权限，仅可访问国资企业相关功能
- **权限表**：
  | 功能模块 | 管理员 | 开发商 | 收件人 | 国资企业专窗 |
  |---------|-------|-------|-------|------------|
  | 全部收件管理 | √ | × | × | × |
  | 用户管理 | √ | × | × | × |
  | 统计报表 | √ | × | √ | √ |
  | 我的收件 | √ | √ | √ | √ |
  | 开发商业务 | × | √ | × | × |
  | 国资企业业务 | × | × | × | √ |

### 2.2 工作台功能

#### 2.2.1 管理员工作台
- **功能描述**：管理员的主要操作界面，展示系统总体数据概览
- **界面元素**：
  - 统计卡片：
    - 总收件数（总体统计）
    - 本月收件（所有人总计）
    - 活跃用户数
  - 管理功能快捷入口：
    - 全部收件管理按钮：点击跳转到所有案件列表页面
    - 用户管理按钮：点击跳转到用户管理页面
    - 统计报表按钮：点击跳转到统计分析页面
  - 系统最近收件记录表格：显示最近10条收件记录
    - 查看全部按钮：点击跳转到所有案件列表页面

#### 2.2.2 用户工作台
- **功能描述**：普通用户的主要操作界面，展示个人工作数据
- **界面元素**：
  - 统计卡片：
    - 总收件数（个人）
    - 本月收件（个人）
  - 工作快捷入口：
    - 我的收件按钮：点击跳转到个人案件列表页面
    - 开发商业务按钮：开发商角色显示，点击跳转到开发商业务页面
    - 国资企业业务按钮：国资企业专窗角色显示，点击跳转到国资企业业务页面
    - 个人统计按钮：收件人、国资企业专窗角色显示，点击跳转到统计分析页面
  - 最近收件记录表格：显示用户最近10条收件记录
    - 查看全部按钮：点击跳转到个人案件列表页面
    - 查看按钮：点击查看案件详情

### 2.3 案件管理功能

#### 2.3.1 案件列表
- **功能描述**：展示案件列表，支持查询和筛选
- **界面元素**：
  - 案件编号、收件人、案件类型、处理人、状态、收件日期、案件描述列
  - 查看按钮：查看案件详情
  - 状态标签：不同状态显示不同颜色（已完成-绿色、处理中-蓝色、未处理-黄色、已分配-灰色）
  - 案件类型标签：不同类型显示不同颜色
- **业务规则**：
  - 管理员可查看所有案件
  - 普通用户仅可查看自己相关的案件

#### 2.3.2 收件规则
- **功能描述**：定义不同角色的案件接收和处理规则
- **角色规则**：
  
  **管理员**：admin
  - 可接收所有类型的案件
  - 可查看所有用户的收件情况
  - 可手动分配案件给任何处理人员
  - 可调整任何案件的状态和分配信息
  - 可接收系统自动分配的案件
  - 无案件类型和数量限制

  **开发商**：金域香江、山水华庭、观澜府一期、观澜府南苑、观澜府云玺、北宸天、临江府、幸福里、联合名典、东城巷、霞光名苑
  - 仅可接收开发商业务相关的案件
  - 仅可查看自己创建和接收的案件
  - 不可手动分配案件给其他处理人员
  - 可提交新的开发商业务案件
  - 接收的案件自动分配给收件人
  - 无案件数量限制

  **收件人**：顾永彪、杨海艺、童昭仪
  - 可接收普通业务案件
  - 仅可查看自己接收的案件
  - 不可手动分配案件
  - 接收系统自动分配的案件
  - 无案件数量限制

  **国资企业专窗**：杨苗苗
  - 仅可接收国资企业业务相关的案件
  - 仅可查看自己创建和接收的案件
  - 不可手动分配案件给其他处理人员
  - 可提交新的国资企业业务案件
  - 接收的案件自动分配给自己
  - 无案件数量限制
- **分配优先级**：
  1. 案件类型匹配：根据用户角色和权限匹配案件类型
  2. 轮询分配：相同权限的用户按轮询方式分配案件
  3. 手动分配：管理员可覆盖自动分配规则

#### 2.3.3 案件分配
- **功能描述**：系统自动分配案件给处理人员
- **业务规则**：
  - 分配时同时更新cases表的receiver和receiver_id字段
  - 支持手动调整分配
  - 遵循2.3.2节的收件规则
  - **更新规则（2025-11-29）**：
    - 除开发商转移案件外，收件人录入的案件应自动分配给自己
    - 国资企业专窗不变，保持原有逻辑
    - 实现轮询机制提醒下一个收件人，当收件人A完成一个案件后，提示A下一个案件应该由收件人B来接收，以此类推

### 2.4 统计分析功能

#### 2.4.1 统计筛选
- **功能描述**：提供时间维度的统计数据筛选
- **界面元素**：
  - 年份选择器：下拉选择，默认为当前年份
  - 月份选择器：下拉选择，支持选择全部月份
- **业务规则**：
  - 选择变更时自动刷新统计数据
  - 年份范围：当前年份前4年至当前年份

#### 2.4.2 统计图表
- **功能描述**：以图表形式展示统计数据
- **图表类型**：
  - 案件类型统计：饼图，展示各类型案件占比
  - 收件人统计：柱状图，展示各收件人案件数量
  - 工作量趋势：折线图，展示工作量变化趋势

#### 2.4.3 统计概览
- **功能描述**：以数字卡片形式展示关键统计指标
- **统计指标**：
  - 总案件数
  - 已完成案件数
  - 待处理案件数
  - 已分配案件数
  - 平均评分

#### 2.4.4 详细统计表格
- **功能描述**：以表格形式展示详细统计数据
- **表格类型**：
  - 案件类型详细统计：展示各类型案件数量和占比
  - 处理人统计分析：展示各处理人案件数量、已完成数、待处理数和完成率
  - 案件状态统计：展示各状态案件数量和占比

## 3. 非功能需求

### 3.5 代码重构记录（2025-11-29）
- **后端服务重构**：
  - 简化了 `allocationService.js` 中的 `getNextCaseReceiver` 函数，使其在不是开发商转移案件时返回当前用户
  - 移除了 `getAvailableCaseTypes` 函数中的用户权限检查，简化了逻辑
  - 更新了 `cases.js` 中的 `createCase` 函数，为收件人录入的案件自动分配当前用户
  
- **前端组件重构**：
  - 简化了 `Cases.vue` 组件，移除了不必要的权限检查和WebSocket事件监听
  - 重构了 `DeveloperCase.vue` 组件，删除了未使用的功能和冗余代码
  - 移除了前端代码中的轮询提醒机制，改为更简单的分配逻辑
  
- **API接口简化**：
  - 删除了未使用的API接口，如 `getNextCaseReceiver`、`getUserCasePermissions`、`getUserNotifications` 等
  - 简化了 `caseAPI` 对象，只保留核心功能接口
  - 移除了复杂的请求限制和重试机制，简化了API调用流程
  
- **数据库结构变更**：
  - 优化了案件分配相关的表结构，删除了不必要的字段
  - 简化了用户权限相关的数据模型，提高了系统性能

### 3.1 性能需求
- **响应时间**：页面加载时间 ≤ 2秒，API请求响应时间 ≤ 500ms
- **并发支持**：支持至少50个用户同时在线使用
- **实时性**：数据更新延迟 ≤ 1秒

### 3.2 可靠性需求
- **系统可用性**：≥ 99.9%
- **数据备份**：每日自动备份数据库
- **错误处理**：系统错误友好提示，关键操作日志记录

### 3.3 安全需求
- **密码加密**：用户密码采用加盐哈希存储
- **接口认证**：API接口采用JWT认证
- **权限控制**：基于角色的细粒度权限控制
- **数据传输**：支持HTTPS加密传输

### 3.4 兼容性需求
- **浏览器支持**：Chrome 90+、Firefox 88+、Safari 14+、Edge 90+
- **响应式设计**：支持桌面端和平板设备

## 4. 数据需求

### 4.1 核心数据模型

#### 4.1.1 用户表 (users)
| 字段名 | 数据类型 | 描述 |
|-------|---------|------|
| id | INT | 用户ID |
| username | VARCHAR(50) | 用户名 |
| password | VARCHAR(255) | 密码 |
| real_name | VARCHAR(50) | 真实姓名 |
| role | ENUM('收件人','管理员','开发商','国资企业专窗') | 用户角色，默认值为"收件人" |
| expertise_level | INT | 专业水平等级 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

#### 4.1.2 案件表 (cases)
| 字段名 | 数据类型 | 描述 |
|-------|---------|------|
| id | INT | 案件ID |
| case_number | VARCHAR(50) | 案件编号 |
| case_type | VARCHAR(50) | 案件类型 |
| receiver | VARCHAR(50) | 收件人姓名 |
| receiver_id | INT | 收件人ID |
| assigned_to | VARCHAR(50) | 处理人姓名 |
| status | VARCHAR(20) | 案件状态 |
| case_date | DATE | 收件日期 |
| case_description | TEXT | 案件描述 |



### 4.2 API接口

#### 4.2.1 认证接口
- **登录**：POST /api/auth/login
- **登出**：POST /api/auth/logout

#### 4.2.2 统计接口
- **获取统计数据**：GET /api/statistics
  - 参数：timeFilter、userId
  - 返回：totalCount、monthlyCount、roleStatistics等

#### 4.2.3 案件接口
- **获取案件列表**：GET /api/cases
- **获取单个案件**：GET /api/cases/:id
- **创建案件**：POST /api/cases
- **更新案件**：PUT /api/cases/:id
- **删除案件**：DELETE /api/cases/:id

#### 4.2.4 用户接口
- **获取用户列表**：GET /api/users
- **获取单个用户**：GET /api/users/:id

## 5. 界面需求

### 5.1 设计风格
- **整体风格**：简洁、专业、现代
- **主色调**：蓝色系（#409EFF）
- **辅助色**：绿色（#67C23A）、黄色（#E6A23C）、红色（#F56C6C）
- **字体**：系统默认字体，无衬线字体

### 5.2 布局规范
- **页面结构**：顶部导航栏 + 左侧菜单栏 + 主内容区
- **响应式设计**：
  - 桌面端：完整三栏布局
  - 平板端：自适应两栏布局
- **边距**：
  - 页面内边距：20px
  - 组件间距：16px
  - 卡片间距：20px

### 5.3 组件规范
- **按钮**：
  - 主要按钮：蓝色，圆角4px
  - 次要按钮：灰色，圆角4px
  - 按钮高度：36px
- **输入框**：
  - 文本输入框：圆角4px，高度36px
  - 边框颜色：#DCDFE6
  - 聚焦状态：边框颜色#409EFF
- **卡片**：
  - 背景色：白色
  - 边框：1px solid #EBEEF5
  - 圆角：4px
  - 阴影：0 2px 12px 0 rgba(0, 0, 0, 0.1)

## 6. 系统配置

### 6.1 服务器配置
- **前端服务器**：
  - 端口：5174
  - 代理配置：将/api请求代理到后端服务器
- **后端服务器**：
  - 端口：3004
  - 数据库连接：MySQL

### 6.2 环境变量
- **前端**：
  - VITE_API_BASE_URL：API基础URL
- **后端**：
  - DB_HOST：数据库主机
  - DB_USER：数据库用户名
  - DB_PASSWORD：数据库密码
  - DB_NAME：数据库名
  - JWT_SECRET：JWT密钥
  - PORT：服务器端口

## 7. 部署与维护

### 7.1 部署流程
1. 安装Node.js和MySQL
2. 配置数据库连接
3. 执行数据库迁移
4. 启动后端服务器：npm start
5. 启动前端开发服务器：npm run dev
6. 生产环境构建：npm run build

### 7.2 维护要求
- 定期备份数据库
- 监控系统运行状态
- 及时更新依赖包
- 定期清理日志文件

## 8. 培训与支持

### 8.1 用户培训
- 提供系统操作手册
- 组织用户培训会议
- 录制操作演示视频

### 8.2 技术支持
- 提供在线技术支持
- 定期系统维护与升级
- 故障响应时间：24小时内

## 9. 验收标准

### 9.1 功能验收
- 所有功能模块按照需求文档实现
- 用户界面符合设计规范
- 数据处理逻辑正确
- 系统性能满足要求

### 9.2 测试用例
- 登录功能测试
- 权限控制测试
- 案件管理测试
- 统计分析测试
- 响应式设计测试
- 性能测试
- 安全测试

## 10. 附录

### 10.1 术语定义
- **收件**：不动产登记案件的接收和登记
- **案件类型**：包括首次登记、转移登记、抵押登记、变更登记、注销登记等
- **完成率**：已完成案件数与总案件数的比值

### 10.2 参考文档
- 《不动产登记暂行条例》
- 《不动产登记操作规范》
- Vue 3官方文档
- Element Plus官方文档
- ECharts官方文档