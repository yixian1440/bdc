# 系统管理员角色状态管理功能实现计划

## 功能需求

系统管理员可以控制收件人和国资企业专窗角色的状态，分为"正常"和"休假"两种。休假状态下的用户不再接受分配开发商转移案件，正常状态下功能正常。

## 实现步骤

### 1. 数据库修改

* **添加用户状态字段**：在users表中添加status字段，默认值为"正常"

* **执行SQL**：`ALTER TABLE users ADD COLUMN status VARCHAR(20) DEFAULT '正常' NOT NULL`

### 2. 后端修改

#### 2.1 用户API更新（users.js）

* **获取用户列表**：修改GET /users接口，返回用户status字段

* **添加用户**：修改POST /users接口，支持status参数（默认"正常"）

* **更新用户**：修改PUT /:id接口，支持status字段更新

#### 2.2 案件分配逻辑修改（allocationService.js）

* **修改getAvailableReceivers方法**：在获取可用接收人员时，过滤掉status为"休假"的用户

* **影响案件类型**：开发商转移、开发商转移登记

### 3. 前端修改（Users.vue）

* **添加状态列**：在用户列表中显示状态信息

* **状态显示**：使用不同颜色的标签显示"正常"（绿色）和"休假"（黄色）

* **状态编辑**：在添加/编辑用户对话框中，添加状态选择下拉框

* **表单验证**：添加状态字段的必填验证

## 代码修改点

### 后端修改

1. **文件**：`backend/routes/users.js`

   * 第95行：修改SQL查询，添加status字段

   * 第146-148行：修改INSERT语句，添加status字段

   * 第184-187行：修改UPDATE语句，添加status字段

2. **文件**：`backend/services/allocationService.js`

   * 第40-44行：修改SQL查询，添加`AND status = '正常'`条件

### 前端修改

1. **文件**：`frontend/src/views/Users.vue`

   * 第187-194行：在userForm中添加status字段

   * 第197-225行：添加status字段验证规则

   * 第45-56行：添加状态列到用户表格

   * 第119-125行：在表单中添加状态选择组件

   * 第330-339行：编辑用户时复制status字段

   * 第373-386行：提交表单时包含status字段

## 实现效果

* 系统管理员可以在用户管理页面查看所有用户的状态

* 可以通过添加/编辑用户对话框修改用户状态

* 休假状态的用户不会被分配开发商转移案件

* 正常状态的用户功能不受影响

* 所有修改无需重启系统即可生效

## 技术要点

* 使用数据库ALTER语句动态添加字段

* 修改现有API接口支持新字段

* 更新案件分配逻辑，根据状态过滤可用接收人员

* 前端界面添加状态显示和编辑功能

* 保持前后端数据一致性

## 测试建议

1. 添加新用户，验证默认状态为"正常"
2. 修改用户状态为"休假"，验证不再被分配案件
3. 修改用户状态为"正常"，验证可以被分配案件
4. 检查用户列表中状态显示是否正确
5. 验证不同角色的用户状态管理权限

