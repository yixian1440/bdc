# 不动产登记收件统计系统重构计划

## 1. 数据库结构调整

### 1.1 案件表 (cases) 调整
- **删除不必要字段**：user_id, priority_level, complexity_level, estimated_duration, assigned_weight, allocation_suggestion, is_allocated
- **添加缺失字段**：assigned_to (处理人姓名), assigned_to_id (处理人ID), completed_at (完成时间)
- **调整字段类型**：确保所有字段类型符合需求文档

### 1.2 用户表 (users) 调整
- **保留现有字段**：id, username, password, real_name, role, expertise_level, created_at, updated_at
- **删除不必要字段**：current_workload, max_workload

### 1.3 新建分配历史表 (allocation_history)
- 记录案件分配的历史记录，用于跟踪分配情况
- 字段：id, case_id, previous_receiver_id, new_receiver_id, allocated_by, allocated_at, reason

## 2. 后端API接口重构

### 2.1 认证接口
- 确保登录、登出功能正常工作
- 实现JWT认证机制

### 2.2 案件接口
- 重构案件创建逻辑，实现自动分配功能
- 确保案件列表、获取单个案件、更新案件、删除案件功能正常工作
- 添加案件分配历史记录功能

### 2.3 统计接口
- 完善统计数据获取逻辑
- 确保支持时间维度的统计数据筛选
- 实现多维度统计分析

### 2.4 用户接口
- 确保用户列表、获取单个用户功能正常工作

## 3. 案件分配逻辑重构

### 3.1 自动分配规则
- 除开发商转移案件外，收件人录入的案件应自动分配给自己
- 国资企业专窗案件自动分配给自己
- 实现轮询机制，当收件人A完成一个案件后，提示A下一个案件应该由收件人B来接收

### 3.2 分配优先级
1. 案件类型匹配：根据用户角色和权限匹配案件类型
2. 轮询分配：相同权限的用户按轮询方式分配案件
3. 手动分配：管理员可覆盖自动分配规则

## 4. 权限控制实现

### 4.1 后端权限控制
- 实现基于角色的权限控制中间件
- 确保不同角色只能访问相应的功能模块

### 4.2 前端权限控制
- 实现路由守卫，根据用户角色控制页面访问
- 控制菜单栏和功能按钮的显示

## 5. 统计分析功能完善

### 5.1 统计筛选功能
- 实现年份和月份的筛选功能
- 确保选择变更时自动刷新统计数据

### 5.2 统计图表功能
- 实现案件类型统计饼图
- 实现收件人统计柱状图
- 实现工作量趋势折线图

### 5.3 统计概览功能
- 实现统计指标卡片，包括总案件数、已完成案件数、待处理案件数、已分配案件数

### 5.4 详细统计表格
- 实现案件类型详细统计表格
- 实现处理人统计分析表格
- 实现案件状态统计表格

## 6. WebSocket功能检查

### 6.1 实时数据更新
- 确保WebSocket服务正常工作
- 实现案件创建、更新、分配时的实时通知
- 实现统计数据的实时更新

### 6.2 轮询机制提醒
- 实现轮询机制提醒下一个收件人

## 7. 前端组件重构

### 7.1 布局组件
- 实现顶部导航栏 + 左侧菜单栏 + 主内容区的布局
- 确保响应式设计正常工作

### 7.2 工作台组件
- 实现管理员工作台
- 实现用户工作台

### 7.3 案件管理组件
- 实现案件列表组件
- 实现案件详情组件
- 实现案件创建组件
- 实现案件编辑组件

### 7.4 统计分析组件
- 实现统计筛选组件
- 实现统计图表组件
- 实现统计概览组件
- 实现详细统计表格组件

## 8. 系统配置调整

### 8.1 前端配置
- 确保前端服务器端口为 5174
- 配置API基础URL

### 8.2 后端配置
- 确保后端服务器端口为 3004
- 配置数据库连接
- 配置WebSocket服务

## 9. 测试与验证

### 9.1 功能测试
- 测试所有功能模块是否按照需求文档实现
- 测试用户界面是否符合设计规范
- 测试数据处理逻辑是否正确

### 9.2 性能测试
- 测试系统响应时间是否符合要求
- 测试系统并发支持是否符合要求

### 9.3 安全测试
- 测试权限控制是否有效
- 测试数据传输是否安全

## 10. 部署与维护

### 10.1 部署流程
- 配置数据库连接
- 执行数据库迁移
- 启动后端服务器
- 启动前端开发服务器
- 生产环境构建

### 10.2 维护要求
- 定期备份数据库
- 监控系统运行状态
- 及时更新依赖包
- 定期清理日志文件

## 11. 重构步骤

1. 首先进行数据库结构调整
2. 重构后端API接口
3. 实现案件分配逻辑
4. 实现权限控制
5. 完善统计分析功能
6. 检查WebSocket功能
7. 重构前端组件
8. 进行系统配置调整
9. 进行测试与验证
10. 部署与维护

## 12. 预期结果

1. 所有代码完整，功能可用
2. 数据库结构符合需求文档
3. 系统性能满足要求
4. 界面美观，用户体验良好
5. 系统安全可靠

通过以上重构计划，我将确保不动产登记收件统计系统符合需求文档的所有要求，功能完整，性能良好，用户体验良好。